{% extends "base.html" %}

{% block title %}{{ product.title }} | NutriCoreIQ{% endblock %}

{% block extra_head %}
<style nonce="{{ csp_nonce }}"></style>
{% endblock %}

{% block content %}
<div class="container">
    <div class="row justify-content-center">
        <div class="col-lg-10">
            <h1 class="text-center mb-5" style="color: var(--moss);">{{ product.title }}</h1>

            <!-- Белки и аминокислоты -->
            {% if product.proteins.total %}
            <div class="nutrient-section">
                <h2 class="section-title">
                    Белки <span class="nutrient-value">{{ product.proteins.total|default(0)|round(2) }} г</span>
                </h2>

                {% if product.proteins.amino_acids %}
                <div class="subgroup">

                    {% if product.proteins.amino_acids.nonessential %}
                        <div class="nutrient-row">
                            <span class="nutrient-label">Заменимые аминокислоты</span>
                            <span class="nutrient-value">{{ product.proteins.amino_acids.nonessential / 1000|round(3) }} г</span>
                        </div>
                    {% endif %}

                    {% if product.proteins.amino_acids.essential %}
                        <div class="nutrient-row">
                            <span class="nutrient-label">Незаменимые аминокислоты</span>
                            <span class="nutrient-value">{{ product.proteins.amino_acids.essential / 1000|round(3) }} г</span>
                        </div>
                    {% endif %}

                    {% if product.proteins.amino_acids.cond_essential %}
                        <div class="nutrient-row">
                            <span class="nutrient-label">Условнонезаменимые</span>
                            <span class="nutrient-value">{{ product.proteins.amino_acids.cond_essential / 1000| round(3) }} г</span>
                        </div>
                    {% endif %}

                </div>
                {% endif %}
            </div>
            {% endif %}

            <!-- Жиры -->
            {% if product.fats %}
            <div class="nutrient-section">
                <h2 class="section-title">
                    Жиры <span class="nutrient-value">{{ product.fats.total | default(0) | round(2) }} г</span>
                </h2>

                <div class="subgroup">
                    {% if product.fats.breakdown.saturated %}
                    <div class="nutrient-row">
                        <span class="nutrient-label">Насыщенные</span>
                        <span class="nutrient-value">{{ product.fats.breakdown.saturated | round(2) }} г</span>
                    </div>
                    {% endif %}

                    {% if product.fats.breakdown.monounsaturated %}
                    <div class="nutrient-row">
                        <span class="nutrient-label">Мононенасыщенные</span>
                        <span class="nutrient-value">{{ product.fats.breakdown.monounsaturated | round(2) }} г</span>
                    </div>
                    {% endif %}

                    {% if product.fats.breakdown.polyunsaturated %}
                    <div class="nutrient-row">
                        <span class="nutrient-label">Полиненасыщенные</span>
                        <span class="nutrient-value">{{ product.fats.breakdown.polyunsaturated.total | round(2) }} г</span>
                        <div class="subgroup">
                            {% if product.fats.breakdown.polyunsaturated.omega3 %}
                            <div class="nutrient-row">
                                <span class="nutrient-label">Омега-3</span>
                                <span class="nutrient-value">{{ product.fats.breakdown.polyunsaturated.omega3 | round(2) }} г</span>
                            </div>
                            {% endif %}

                            {% if product.fats.breakdown.polyunsaturated.omega6 %}
                            <div class="nutrient-row">
                                <span class="nutrient-label">Омега-6</span>
                                <span class="nutrient-value">{{ product.fats.breakdown.polyunsaturated.omega6 | round(2) }} г</span>
                            </div>
                            {% endif %}
                        </div>
                    </div>
                    {% endif %}

                    {% if product.fats.breakdown.cholesterol %}
                    <div class="nutrient-row">
                        <span class="nutrient-label">Холестерин</span>
                        <span class="nutrient-value">{{ product.fats.breakdown.cholesterol | round(2) }} мг</span>
                    </div>
                    {% endif %}
                </div>
            </div>
            {% endif %}

            <!-- Углеводы -->
            {% if product.carbs %}
            <div class="nutrient-section">
                <h2 class="section-title">
                    Углеводы <span class="nutrient-value">{{ product.carbs.total | default(0) | round(2) }} г</span>
                </h2>

                <div class="subgroup">
                    {% if product.carbs.breakdown.fiber %}
                    <div class="nutrient-row">
                        <span class="nutrient-label">Клетчатка</span>
                        <span class="nutrient-value">{{ product.carbs.breakdown.fiber | round(2) }} г</span>
                    </div>
                    {% endif %}

                    {% if product.carbs.breakdown.sugar %}
                    <div class="nutrient-row">
                        <span class="nutrient-label">Сахара</span>
                        <span class="nutrient-value">{{ product.carbs.breakdown.sugar | round(2) }} г</span>
                    </div>
                    {% endif %}
                </div>
            </div>
            {% endif %}

            <!-- Витамины -->
            {% if product.vitamins %}
            <div class="nutrient-section">
                <h2 class="section-title">Витамины</h2>

                {% if product.vitamins.vits %}
                    <div class="vitamin-grid">
                        {% for vitamin in product.vitamins.vits %}
                            {% if vitamin.amount %}
                                <div class="micro-card">
                                    <div class="fw-bold mb-1" style="color: var(--moss);">{{ vitamin.name }}</div>
                                    <div style="color: var(--clay);">
                                        {{ vitamin.amount }} {{ vitamin.unit }}
                                        {% if vitamin.rda %}<span class="text-muted small">({{ vitamin.rda }}%)</span>{% endif %}
                                    </div>
                                </div>
                            {% endif %}
                        {% endfor %}
                    </div>
                {% endif %}
            </div>
            {% endif %}

            <!-- Витаминоподобные вещества -->
            {% if product.vitamin_like %}
            <div class="nutrient-section">
                <h2 class="section-title">Витаминоподобные вещества</h2>

                {% if product.vitamin_like.vitslk %}
                    <div class="vitamin-grid">
                        {% for substance in product.vitamin_like.vitslk %}
                            {% if substance.amount %}
                                <div class="micro-card">
                                    <div class="fw-bold mb-1" style="color: var(--sage);">{{ substance.name }}</div>
                                    <div style="color: var(--stone);">
                                        {{ substance.amount }} {{ substance.unit }}
                                        {% if substance.rda %}<span class="text-muted small">({{ substance.rda }}%)</span>{% endif %}
                                    </div>
                                </div>
                            {% endif %}
                        {% endfor %}
                    </div>
                {% endif %}
            </div>
            {% endif %}

            <!-- Минералы -->
            {% if product.minerals %}
            <div class="nutrient-section">
                <h2 class="section-title">Минералы</h2>

                {% if product.minerals.macro %}
                <div class="subgroup">
                    <h5 class="mb-3" style="color: var(--earth);">Макроэлементы</h5>
                    {% for mineral in product.minerals.macro %}
                        {% if mineral.amount %}
                            <div class="nutrient-row">
                                <span class="nutrient-label">{{ mineral.name }}</span>
                                <span class="nutrient-value">{{ mineral.amount }} {{ mineral.unit }}</span>
                            </div>
                        {% endif %}
                    {% endfor %}
                </div>
                {% endif %}

                {% if product.minerals.micro %}
                <div class="subgroup mt-4">
                    <h5 class="mb-3" style="color: var(--earth);">Микроэлементы</h5>
                    {% for mineral in product.minerals.micro %}
                        {% if mineral.amount %}
                            <div class="nutrient-row">
                                <span class="nutrient-label">{{ mineral.name }}</span>
                                <span class="nutrient-value">{{ mineral.amount }} {{ mineral.unit }}</span>
                            </div>
                        {% endif %}
                    {% endfor %}
                </div>
                {% endif %}
            </div>
            {% endif %}

            <!-- Другие компоненты -->
            {% if product.others %}
            <div class="nutrient-section">
                <h2 class="section-title">Другие биоактивные компоненты</h2>
                <div class="row g-3">
                    {% for item in product.others.oths %}
                        {% if item.amount %}
                            <div class="col-md-6">
                                <div class="nutrient-row align-items-center">
                                    <span class="nutrient-label">{{ item.name }}</span>
                                    <span class="nutrient-value">
                                        {{ item.amount }}{{ item.unit }}
                                        {% if item.rda %}<span class="text-muted small">({{ item.rda }}%)</span>{% endif %}
                                    </span>
                                </div>
                            </div>
                        {% endif %}
                    {% endfor %}
                </div>
            </div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}