{% extends "base.html" %}

{% block title %}–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç | NutriCoreIQ{% endblock %}

{% block user_buttons %}
    <!-- –ö–∞—Å—Ç–æ–º–Ω—ã–µ –∫–Ω–æ–ø–∫–∏ –¥–ª—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã –ø—Ä–æ—Ñ–∏–ª—è -->
    <a href="/" class="btn btn-outline">–ì–ª–∞–≤–Ω–∞—è</a>
    <a href="/api/v1/auth/logout" class="btn btn-outline-danger">–í—ã–π—Ç–∏</a>
{% endblock %}


{% block content %}
<div class="container">
    <!-- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è -->
    <div id="profile-error" class="alert alert-danger d-none"></div>
    <div id="profile-success" class="alert alert-success d-none"></div>

    <!-- –û—Å–Ω–æ–≤–Ω–∞—è –∫–∞—Ä—Ç–æ—á–∫–∞ –ø—Ä–æ—Ñ–∏–ª—è -->
    <div class="profile-card">
        <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ –ø—Ä–æ—Ñ–∏–ª—è -->
        <div class="profile-header">
            <div class="d-flex flex-column flex-md-row align-items-md-center gap-4">
                <!-- –ê–≤–∞—Ç–∞—Ä -->
                <div class="profile-avatar">
                    {{ user.username[0]|upper }}
                </div>

                <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
                <div class="profile-info flex-grow-1">
                    <h1 class="mb-2">{{ user.username }}</h1>
                    <p class="lead text-muted mb-0">{{ user.email }}</p>
                </div>

                <!-- –ö–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π -->
                <div class="action-buttons mt-3 mt-md-0">
                    <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#editProfileModal">
                        <i class="bi bi-pencil"></i> –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
                    </button>
                    <button type="button" class="btn btn-outline" data-bs-toggle="modal" data-bs-target="#changePasswordModal">
                        <i class="bi bi-shield-lock"></i> –°–º–µ–Ω–∏—Ç—å –ø–∞—Ä–æ–ª—å
                    </button>
                </div>
            </div>
        </div>

        <!-- –î–µ—Ç–∞–ª–∏ –ø—Ä–æ—Ñ–∏–ª—è -->
        <div class="profile-details mt-5">
            <div class="row g-4">
                <!-- –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
                <div class="col-md-6 col-lg-4">
                    <div class="detail-card h-100">
                        <h3 class="mb-4 text-moss"><i class="bi bi-person"></i> –û—Å–Ω–æ–≤–Ω–æ–µ</h3>
                        <div class="detail-item">
                            <div class="d-flex justify-content-between">
                                <span>–ü–æ–ª:</span>
                                <span id="gender-field" class="fw-medium">
                                    {% if user.gender == 'male' %}–ú—É–∂—Å–∫–æ–π
                                    {% elif user.gender == 'female' %}–ñ–µ–Ω—Å–∫–∏–π
                                    {% else %}–ù–µ —É–∫–∞–∑–∞–Ω{% endif %}
                                </span>
                            </div>
                        </div>
                        <div class="detail-item mt-3">
                            <div class="d-flex justify-content-between">
                                <span>–í–æ–∑—Ä–∞—Å—Ç:</span>
                                <span id="age-field" class="fw-medium">
                                    {{ user.age|default('‚Äî', true) }}
                                </span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- –§–∏–∑–∏—á–µ—Å–∫–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã -->
                <div class="col-md-6 col-lg-4">
                    <div class="detail-card h-100">
                        <h3 class="mb-4 text-sage"><i class="bi bi-rulers"></i> –ü–∞—Ä–∞–º–µ—Ç—Ä—ã</h3>
                        <div class="detail-item">
                            <div class="d-flex justify-content-between">
                                <span>–†–æ—Å—Ç (—Å–º):</span>
                                <span id="height-field" class="fw-medium">
                                    {{ user.height|default('‚Äî', true) }}
                                </span>
                            </div>
                        </div>
                        <div class="detail-item mt-3">
                            <div class="d-flex justify-content-between">
                                <span>–í–µ—Å (–∫–≥):</span>
                                <span id="weight-field" class="fw-medium">
                                    {{ user.weight|default('‚Äî', true) }}
                                </span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ -->
                <div class="col-lg-4">
                    <div class="detail-card h-100">
                        <h3 class="mb-4 text-clay"><i class="bi bi-graph-up"></i> –ê–Ω–∞–ª–∏—Ç–∏–∫–∞</h3>
                        <div class="detail-item">
                            <div class="d-flex justify-content-between">
                                <span>–¶–µ–ª—å:</span>
                                <span id="goal-field" class="fw-medium">
                                    {% if user.goal %}{{ user.goal }}{% else %}‚Äî{% endif %}
                                </span>
                            </div>
                        </div>
                        <div class="detail-item mt-3">
                            <div class="d-flex justify-content-between">
                                <span>–ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å:</span>
                                <span id="kfa-field" class="fw-medium">
                                    {% if user.kfa %}{{ user.kfa }} —É—Ä–æ–≤–µ–Ω—å{% else %}‚Äî{% endif %}
                                </span>
                            </div>
                        </div>
                        <div class="detail-item mt-3">
                            <div class="d-flex justify-content-between">
                                <span>–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è:</span>
                                <span id="registration-date-field" class="fw-medium">
                                    {{ user.created_at|default('‚Äî', true) }}
                                </span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä–æ—Ñ–∏–ª—è -->
<div class="modal fade" id="editProfileModal" tabindex="-1" aria-labelledby="editProfileModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="editProfileModalLabel">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ—Ñ–∏–ª—å</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="–ó–∞–∫—Ä—ã—Ç—å"></button>
            </div>
            <div class="modal-body">
                <form id="editProfileForm">
                    <input type="hidden" name="_csrf_token" value="{{ csrf_token }}">

                    <div class="mb-3">
                        <label for="editGender" class="form-label">–ü–æ–ª</label>
                        <select class="form-select" id="editGender" name="gender">
                            <option value="">{% if user.gender == 'male' %}
                                                –ú—É–∂—Å–∫–æ–π
                                             {% elif user.gender == 'female' %}
                                                –ñ–µ–Ω—Å–∫–∏–π
                                             {% else %}
                                                –ù–µ —É–∫–∞–∑–∞–Ω
                                             {% endif %}
                            </option>
                            <option value="male" {% if user.gender == 'male' %}selected{% endif %}>–ú—É–∂—Å–∫–æ–π</option>
                            <option value="female" {% if user.gender == 'female' %}selected{% endif %}>–ñ–µ–Ω—Å–∫–∏–π</option>
                        </select>
                        <div id="editGenderError" class="invalid-feedback d-none"></div>
                    </div>

                    <div class="mb-3">
                        <label for="editAge" class="form-label">–í–æ–∑—Ä–∞—Å—Ç</label>
                        <input type="number" class="form-control" id="editAge" name="age"
                               value="{{ user.age if user.age is not none }}" min="18" max="120"
                               placeholder="–í–≤–µ–¥–∏—Ç–µ —Å–≤–æ–π –≤–æ–∑—Ä–∞—Å—Ç">
                    </div>

                    <div class="mb-3">
                        <label for="editHeight" class="form-label">–†–æ—Å—Ç (—Å–º)</label>
                        <input type="number" class="form-control" id="editHeight" name="height"
                               value="{{ user.height if user.height is not none }}" min="50" max="250"
                               placeholder="–í–≤–µ–¥–∏—Ç–µ —Å–≤–æ–π —Ä–æ—Å—Ç">
                    </div>

                    <div class="mb-3">
                        <label for="editWeight" class="form-label">–í–µ—Å (–∫–≥)</label>
                        <input type="number" class="form-control" id="editWeight" name="weight"
                               value="{{ user.weight if user.weight is not none }}" min="20" max="300"
                               placeholder="–í–≤–µ–¥–∏—Ç–µ —Å–≤–æ–π –≤–µ—Å">
                    </div>

                    <div class="mb-3">
                        <label for="editGoal" class="form-label">–í–∞—à–∞ —Ü–µ–ª—å</label>
                        <select class="form-select" id="editGoal" name="goal">
                            <option value="">{% if user.goal %}{{ user.goal }}{% else %}–ù–µ —É–∫–∞–∑–∞–Ω–∞{% endif %}</option>
                            {% for g in ["–°–Ω–∏–∂–µ–Ω–∏–µ –≤–µ—Å–∞", "–£–≤–µ–ª–∏—á–µ–Ω–∏–µ –≤–µ—Å–∞", "–ü–æ–¥–¥–µ—Ä–∂–∞–Ω–∏–µ –≤–µ—Å–∞"] %}
                            <option value="{{ g }}" {{ 'selected' if user.goal == g }}>
                                {{ g }}
                            </option>
                            {% endfor %}
                        </select>
                    </div>

                    <div class="mb-3">
                        <label for="editKfa" class="form-label">–£—Ä–æ–≤–µ–Ω—å —Ñ–∏–∑–∏—á–µ—Å–∫–æ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏</label>
                        <select class="form-select" id="editKfa" name="kfa">
                            <option value="">{% if user.kfa %}{{ user.kfa }}-–π —É—Ä–æ–≤–µ–Ω—å{% else %}–ù–µ —É–∫–∞–∑–∞–Ω{% endif %}</option>
                            {% for k in [1,2,3,4,5] %}
                            <option value="{{ k }}" {{ 'selected' if user.kfa == k|string }}>
                                {{ k }}-–π —É—Ä–æ–≤–µ–Ω—å
                            </option>
                            {% endfor %}
                        </select>
                    </div>

                    <div id="editProfileError" class="alert alert-danger d-none"></div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">–û—Ç–º–µ–Ω–∞</button>
                <button type="button" class="btn btn-register" id="saveProfileBtn">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è</button>
            </div>
        </div>
    </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å–º–µ–Ω—ã –ø–∞—Ä–æ–ª—è -->
<div class="modal fade" id="changePasswordModal" tabindex="-1" aria-labelledby="changePasswordModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="changePasswordModalLabel">–°–º–µ–Ω–∞ –ø–∞—Ä–æ–ª—è</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="–ó–∞–∫—Ä—ã—Ç—å"></button>
            </div>
            <div class="modal-body">
                <form id="changePasswordForm">
                    <input type="hidden" name="_csrf_token" value="{{ csrf_token }}">

                    <div class="mb-3">
                        <label for="currentPassword" class="form-label">–¢–µ–∫—É—â–∏–π –ø–∞—Ä–æ–ª—å</label>
                        <div class="input-group">
                            <input type="password" class="form-control" id="currentPassword" name="current_password" required>
                            <button type="button" class="toggle-password" data-target="password">
                                    üëÅÔ∏è
                            </button>
                        </div>
                    </div>

                    <div class="mb-3">
                        <label for="newPassword" class="form-label">–ù–æ–≤—ã–π –ø–∞—Ä–æ–ª—å</label>
                        <div class="input-group">
                            <input type="password" class="form-control" id="newPassword" name="new_password" required minlength="8">
                            <button type="button" class="toggle-password" data-target="password">
                                    üëÅÔ∏è
                            </button>
                        </div>
                        <div class="form-text">–ú–∏–Ω–∏–º—É–º 8 —Å–∏–º–≤–æ–ª–æ–≤</div>
                    </div>

                    <div class="mb-3">
                        <label for="confirmPassword" class="form-label">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –Ω–æ–≤—ã–π –ø–∞—Ä–æ–ª—å</label>
                        <div class="input-group">
                            <input type="password" class="form-control" id="confirmPassword" name="confirm_password" required minlength="8">
                            <button type="button" class="toggle-password" data-target="password">
                                    üëÅÔ∏è
                            </button>
                        </div>
                    </div>

                    <div id="changePasswordError" class="alert alert-danger d-none"></div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">–û—Ç–º–µ–Ω–∞</button>
                <button type="button" class="btn btn-register" id="savePasswordBtn">–ò–∑–º–µ–Ω–∏—Ç—å –ø–∞—Ä–æ–ª—å</button>
            </div>
        </div>
    </div>
</div>
{% endblock %}
