pg_stat_database:
  query: |
    SELECT
      datname,
      numbackends,
      xact_commit,
      xact_rollback,
      blks_read,
      blks_hit,
      tup_returned,
      tup_fetched,
      tup_inserted,
      tup_updated,
      tup_deleted,
      conflicts,
      temp_files,
      temp_bytes,
      deadlocks,
      checksum_failures,
      checksum_last_failure
    FROM pg_stat_database;
  metrics:
    - datname:
        usage: "LABEL"
        description: "Database name"
    - numbackends:
        usage: "GAUGE"
        description: "Number of backends currently connected"
    - xact_commit:
        usage: "COUNTER"
        description: "Transactions committed"
    - xact_rollback:
        usage: "COUNTER"
        description: "Transactions rolled back"
    - blks_read:
        usage: "COUNTER"
        description: "Disk blocks read"
    - blks_hit:
        usage: "COUNTER"
        description: "Buffer hits"
    - tup_returned:
        usage: "COUNTER"
        description: "Tuples returned"
    - tup_fetched:
        usage: "COUNTER"
        description: "Tuples fetched"
    - tup_inserted:
        usage: "COUNTER"
        description: "Tuples inserted"
    - tup_updated:
        usage: "COUNTER"
        description: "Tuples updated"
    - tup_deleted:
        usage: "COUNTER"
        description: "Tuples deleted"
    - conflicts:
        usage: "COUNTER"
        description: "Conflicts"
    - temp_files:
        usage: "COUNTER"
        description: "Number of temporary files created"
    - temp_bytes:
        usage: "COUNTER"
        description: "Total bytes written to temporary files"
    - deadlocks:
        usage: "COUNTER"
        description: "Deadlocks"
    - checksum_failures:
        usage: "COUNTER"
        description: "Number of data page checksum failures"
    - checksum_last_failure:
        usage: "GAUGE"
        description: "Time of the last checksum failure"

pg_stat_user_tables:
  query: |
    SELECT
      schemaname,
      relname,
      seq_scan,
      seq_tup_read,
      idx_scan,
      idx_tup_fetch,
      n_tup_ins,
      n_tup_upd,
      n_tup_del,
      n_tup_hot_upd,
      n_live_tup,
      n_dead_tup,
      vacuum_count,
      autovacuum_count,
      analyze_count,
      autoanalyze_count
    FROM pg_stat_user_tables;
  metrics:
    - schemaname:
        usage: "LABEL"
        description: "Schema name"
    - relname:
        usage: "LABEL"
        description: "Table name"
    - seq_scan:
        usage: "COUNTER"
        description: "Number of sequential scans"
    - seq_tup_read:
        usage: "COUNTER"
        description: "Number of tuples read by sequential scans"
    - idx_scan:
        usage: "COUNTER"
        description: "Number of index scans"
    - idx_tup_fetch:
        usage: "COUNTER"
        description: "Number of tuples fetched by index scans"
    - n_tup_ins:
        usage: "COUNTER"
        description: "Number of tuples inserted"
    - n_tup_upd:
        usage: "COUNTER"
        description: "Number of tuples updated"
    - n_tup_del:
        usage: "COUNTER"
        description: "Number of tuples deleted"
    - n_tup_hot_upd:
        usage: "COUNTER"
        description: "Number of HOT updates"
    - n_live_tup:
        usage: "GAUGE"
        description: "Estimated number of live tuples"
    - n_dead_tup:
        usage: "GAUGE"
        description: "Estimated number of dead tuples"
    - vacuum_count:
        usage: "COUNTER"
        description: "Number of manual vacuums"
    - autovacuum_count:
        usage: "COUNTER"
        description: "Number of autovacuums"
    - analyze_count:
        usage: "COUNTER"
        description: "Number of manual analyzes"
    - autoanalyze_count:
        usage: "COUNTER"
        description: "Number of autoanalyzes"

pg_stat_statements:
  query: |
    SELECT
      queryid,
      query,
      calls,
      total_exec_time,
      rows,
      shared_blks_hit,
      shared_blks_read,
      shared_blks_dirtied,
      shared_blks_written
    FROM pg_stat_statements;
  metrics:
    - queryid:
        usage: "LABEL"
        description: "Query ID"
    - query:
        usage: "LABEL"
        description: "Query text"
    - calls:
        usage: "COUNTER"
        description: "Number of times the statement was executed"
    - total_exec_time:
        usage: "COUNTER"
        description: "Total execution time of the statement"
    - rows:
        usage: "COUNTER"
        description: "Total number of rows retrieved or affected"
    - shared_blks_hit:
        usage: "COUNTER"
        description: "Total shared block cache hits"
    - shared_blks_read:
        usage: "COUNTER"
        description: "Total shared blocks read"
    - shared_blks_dirtied:
        usage: "COUNTER"
        description: "Total shared blocks dirtied"
    - shared_blks_written:
        usage: "COUNTER"
        description: "Total shared blocks written"

pg_locks:
  query: |
    SELECT
      mode,
      COUNT(*) AS count
    FROM pg_locks
    GROUP BY mode;
  metrics:
    - mode:
        usage: "LABEL"
        description: "Lock mode"
    - count:
        usage: "GAUGE"
        description: "Number of locks held per mode"

pg_stat_replication:
  query: |
    SELECT
      application_name,
      state,
      sync_state,
      CASE
        WHEN pg_current_wal_lsn() = replay_lsn THEN 1
        ELSE 0
      END AS is_caught_up
    FROM pg_stat_replication;
  metrics:
    - application_name:
        usage: "LABEL"
        description: "Name of the replication client"
    - state:
        usage: "LABEL"
        description: "Replication state"
    - sync_state:
        usage: "LABEL"
        description: "Synchronization state"
    - is_caught_up:
        usage: "GAUGE"
        description: "Whether the replica has caught up (1 = true, 0 = false)"
